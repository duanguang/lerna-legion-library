/**
 * legions-thirdparty-plugin v0.0.6
 * (c) 2020 duanguang
 * @license MIT
 */
var legionsThirdpartyDexiePlugin=function(n){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(n,t){return n(t={exports:{}},t.exports),t.exports}function r(n){return n&&n.Math==Math&&n}function u(n){try{return!!n()}catch(n){return!0}}function i(n,t){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:t}}function o(n){return b.call(n).slice(8,-1)}function w(n){if(null==n)throw TypeError("Can't call method on "+n);return n}function f(n){return k(w(n))}function a(n){return"object"==typeof n?null!==n:"function"==typeof n}function c(n,t){if(!a(n))return n;var e,r;if(t&&"function"==typeof(e=n.toString)&&!a(r=e.call(n)))return r;if("function"==typeof(e=n.valueOf)&&!a(r=e.call(n)))return r;if(!t&&"function"==typeof(e=n.toString)&&!a(r=e.call(n)))return r;throw TypeError("Can't convert object to primitive value")}function l(n,t){return x.call(n,t)}function s(n){return O?S.createElement(n):{}}function h(n){if(!a(n))throw TypeError(String(n)+" is not an object");return n}function d(t,e){try{D(p,t,e)}catch(n){p[t]=e}return e}var p=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||Function("return this")(),v=!u(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),y={}.propertyIsEnumerable,g=Object.getOwnPropertyDescriptor,m={f:g&&!y.call({1:2},1)?function(n){var t=g(this,n);return!!t&&t.enumerable}:y},b={}.toString,_="".split,k=u(function(){return!Object("z").propertyIsEnumerable(0)})?function(n){return"String"==o(n)?_.call(n,""):Object(n)}:Object,x={}.hasOwnProperty,S=p.document,O=a(S)&&a(S.createElement),j=!v&&!u(function(){return 7!=Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}),P=Object.getOwnPropertyDescriptor,E={f:v?P:function(n,t){if(n=f(n),t=c(t,!0),j)try{return P(n,t)}catch(n){}if(l(n,t))return i(!m.f.call(n,t),n[t])}},A=Object.defineProperty,I={f:v?A:function(n,t,e){if(h(n),t=c(t,!0),h(e),j)try{return A(n,t,e)}catch(n){}if("get"in e||"set"in e)throw TypeError("Accessors not supported");return"value"in e&&(n[t]=e.value),n}},D=v?function(n,t,e){return I.f(n,t,i(1,e))}:function(n,t,e){return n[t]=e,n},C="__core-js_shared__",T=p[C]||d(C,{}),K=Function.toString;"function"!=typeof T.inspectSource&&(T.inspectSource=function(n){return K.call(n)});function F(n){return"Symbol("+String(void 0===n?"":n)+")_"+(++J+Y).toString(36)}function B(n){return X[n]||(X[n]=F(n))}var M,N,R,q,U,L,z,V,W=T.inspectSource,G=p.WeakMap,Q="function"==typeof G&&/native code/.test(W(G)),H=e(function(n){(n.exports=function(n,t){return T[n]||(T[n]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"\xa9 2020 Denis Pushkarev (zloirock.ru)"})}),J=0,Y=Math.random(),X=H("keys"),$={},Z=p.WeakMap;z=Q?(M=new Z,N=M.get,R=M.has,q=M.set,U=function(n,t){return q.call(M,n,t),t},L=function(n){return N.call(M,n)||{}},function(n){return R.call(M,n)}):(V=B("state"),$[V]=!0,U=function(n,t){return D(n,V,t),t},L=function(n){return l(n,V)?n[V]:{}},function(n){return l(n,V)});function nn(n){return"function"==typeof n?n:void 0}function tn(n,t){return arguments.length<2?nn(mn[n])||nn(p[n]):mn[n]&&mn[n][t]||p[n]&&p[n][t]}function en(n){return isNaN(n=+n)?0:(0<n?wn:bn)(n)}function rn(n){return 0<n?_n(en(n),9007199254740991):0}function on(s){return function(n,t,e){var r,i,o,u=f(n),a=rn(u.length),c=(r=a,(i=en(e))<0?kn(i+r,0):xn(i,r));if(s&&t!=t){for(;c<a;)if((o=u[c++])!=o)return!0}else for(;c<a;c++)if((s||c in u)&&u[c]===t)return s||c||0;return!s&&-1}}function un(n,t){var e,r=f(n),i=0,o=[];for(e in r)!l($,e)&&l(r,e)&&o.push(e);for(;t.length>i;)l(r,e=t[i++])&&(~Sn(o,e)||o.push(e));return o}function an(n,t){var e=Cn[Dn(n)];return e==Kn||e!=Tn&&("function"==typeof t?u(t):!!t)}function cn(n,t){var e,r,i,o,u=n.target,a=n.global,c=n.stat,s=a?p:c?p[u]||d(u,{}):(p[u]||{}).prototype;if(s)for(e in t){if(i=t[e],r=n.noTargetGet?(o=Bn(s,e))&&o.value:s[e],!Fn(a?e:u+(c?".":"#")+e,n.forced)&&void 0!==r){if(typeof i==typeof r)continue;!function(n,t){for(var e=An(t),r=I.f,i=E.f,o=0;o<e.length;o++){var u=e[o];l(n,u)||r(n,u,i(t,u))}}(i,r)}(n.sham||r&&r.sham)&&D(i,"sham",!0),gn(s,e,i,n)}}function sn(r,i,n){if(!function(n){if("function"!=typeof n)throw TypeError(String(n)+" is not a function")}(r),void 0===i)return r;switch(n){case 0:return function(){return r.call(i)};case 1:return function(n){return r.call(i,n)};case 2:return function(n,t){return r.call(i,n,t)};case 3:return function(n,t,e){return r.call(i,n,t,e)}}return function(){return r.apply(i,arguments)}}function fn(n){return l(qn,n)||(Nn&&l(Un,n)?qn[n]=Un[n]:qn[n]=Ln("Symbol."+n)),qn[n]}function ln(n,t){var e;return Mn(n)&&("function"==typeof(e=n.constructor)&&(e===Array||Mn(e.prototype))||a(e)&&null===(e=e[zn]))&&(e=void 0),new(void 0===e?Array:e)(0===t?0:t)}function hn(d){var p=1==d,v=2==d,y=3==d,g=4==d,m=6==d,b=5==d||m;return function(n,t,e,r){for(var i,o,u=Object(w(n)),a=k(u),c=sn(t,e,3),s=rn(a.length),f=0,l=r||ln,h=p?l(n,s):v?l(n,0):void 0;f<s;f++)if((b||f in a)&&(o=c(i=a[f],f,u),d))if(p)h[f]=o;else if(o)switch(d){case 3:return!0;case 5:return i;case 6:return f;case 2:Vn.call(h,i)}else if(g)return!1;return m?-1:y||g?g:h}}function dn(){}function pn(n){return"<script>"+n+"</"+Yn+">"}var vn,yn={set:U,get:L,has:z,enforce:function(n){return z(n)?L(n):U(n,{})},getterFor:function(e){return function(n){var t;if(!a(n)||(t=L(n)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return t}}},gn=e(function(n){var t=yn.get,a=yn.enforce,c=String(String).split("String");(n.exports=function(n,t,e,r){var i=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,u=!!r&&!!r.noTargetGet;"function"==typeof e&&("string"!=typeof t||l(e,"name")||D(e,"name",t),a(e).source=c.join("string"==typeof t?t:"")),n!==p?(i?!u&&n[t]&&(o=!0):delete n[t],o?n[t]=e:D(n,t,e)):o?n[t]=e:d(t,e)})(Function.prototype,"toString",function(){return"function"==typeof this&&t(this).source||W(this)})}),mn=p,bn=Math.ceil,wn=Math.floor,_n=Math.min,kn=Math.max,xn=Math.min,Sn={includes:on(!0),indexOf:on(!1)}.indexOf,On=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],jn=On.concat("length","prototype"),Pn={f:Object.getOwnPropertyNames||function(n){return un(n,jn)}},En={f:Object.getOwnPropertySymbols},An=tn("Reflect","ownKeys")||function(n){var t=Pn.f(h(n)),e=En.f;return e?t.concat(e(n)):t},In=/#|\.prototype\./,Dn=an.normalize=function(n){return String(n).replace(In,".").toLowerCase()},Cn=an.data={},Tn=an.NATIVE="N",Kn=an.POLYFILL="P",Fn=an,Bn=E.f,Mn=Array.isArray||function(n){return"Array"==o(n)},Nn=!!Object.getOwnPropertySymbols&&!u(function(){return!String(Symbol())}),Rn=Nn&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,qn=H("wks"),Un=p.Symbol,Ln=Rn?Un:Un&&Un.withoutSetter||F,zn=fn("species"),Vn=[].push,Wn={forEach:hn(0),map:hn(1),filter:hn(2),some:hn(3),every:hn(4),find:hn(5),findIndex:hn(6)},Gn=Object.keys||function(n){return un(n,On)},Qn=v?Object.defineProperties:function(n,t){h(n);for(var e,r=Gn(t),i=r.length,o=0;o<i;)I.f(n,e=r[o++],t[e]);return n},Hn=tn("document","documentElement"),Jn="prototype",Yn="script",Xn=B("IE_PROTO"),$n=function(){try{vn=document.domain&&new ActiveXObject("htmlfile")}catch(n){}var n,t;$n=vn?function(n){n.write(pn("")),n.close();var t=n.parentWindow.Object;return n=null,t}(vn):((t=s("iframe")).style.display="none",Hn.appendChild(t),t.src=String("javascript:"),(n=t.contentWindow.document).open(),n.write(pn("document.F=Object")),n.close(),n.F);for(var e=On.length;e--;)delete $n[Jn][On[e]];return $n()};$[Xn]=!0;var Zn=Object.create||function(n,t){var e;return null!==n?(dn[Jn]=h(n),e=new dn,dn[Jn]=null,e[Xn]=n):e=$n(),void 0===t?e:Qn(e,t)},nt=fn("unscopables"),tt=Array.prototype;null==tt[nt]&&I.f(tt,nt,{configurable:!0,value:Zn(null)});function et(n){throw n}function rt(n,t){if(l(ut,n))return ut[n];var e=[][n],r=!!l(t=t||{},"ACCESSORS")&&t.ACCESSORS,i=l(t,0)?t[0]:et,o=l(t,1)?t[1]:void 0;return ut[n]=!!e&&!u(function(){if(r&&!v)return 1;var n={length:-1};r?ot(n,1,{enumerable:!0,get:et}):n[1]=1,e.call(n,i,o)})}var it,ot=Object.defineProperty,ut={},at=Wn.find,ct="find",st=!0,ft=rt(ct);ct in[]&&Array(1)[ct](function(){st=!1}),cn({target:"Array",proto:!0,forced:st||!ft},{find:function(n,t){return at(this,n,1<arguments.length?t:void 0)}}),it=ct,tt[nt][it]=!0;var lt,ht,dt=tn("navigator","userAgent")||"",pt=p.process,vt=pt&&pt.versions,yt=vt&&vt.v8;yt?ht=(lt=yt.split("."))[0]+lt[1]:dt&&(!(lt=dt.match(/Edge\/(\d+)/))||74<=lt[1])&&(lt=dt.match(/Chrome\/(\d+)/))&&(ht=lt[1]);var gt,mt=ht&&+ht,bt=fn("species"),wt=Wn.map,_t=(gt="map",51<=mt||!u(function(){var n=[];return(n.constructor={})[bt]=function(){return{foo:1}},1!==n[gt](Boolean).foo})),kt=rt("map");cn({target:"Array",proto:!0,forced:!_t||!kt},{map:function(n,t){return wt(this,n,1<arguments.length?t:void 0)}});var xt=I.f,St=Function.prototype,Ot=St.toString,jt=/^\s*function ([^ (]*)/;!v||"name"in St||xt(St,"name",{configurable:!0,get:function(){try{return Ot.call(this).match(jt)[1]}catch(n){return""}}});var Pt=function(){return(Pt=Object.assign||function(n){for(var t,e=arguments,r=1,i=arguments.length;r<i;r++)for(var o in t=e[r])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)};function Et(n,u,a,c){return new(a=a||Promise)(function(e,t){function r(n){try{o(c.next(n))}catch(n){t(n)}}function i(n){try{o(c.throw(n))}catch(n){t(n)}}function o(n){var t;n.done?e(n.value):((t=n.value)instanceof a?t:new a(function(n){n(t)})).then(r,i)}o((c=c.apply(n,u||[])).next())})}function At(e,r){var i,o,u,a={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},n={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function t(t){return function(n){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(u=2&t[0]?o.return:t[0]?o.throw||((u=o.return)&&u.call(o),0):o.next)&&!(u=u.call(o,t[1])).done)return u;switch(o=0,u&&(t=[2&t[0],u.value]),t[0]){case 0:case 1:u=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(u=0<(u=a.trys).length&&u[u.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!u||t[1]>u[0]&&t[1]<u[3])){a.label=t[1];break}if(6===t[0]&&a.label<u[1]){a.label=u[1],u=t;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(t);break}u[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(e,a)}catch(n){t=[6,n],o=0}finally{i=u=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,n])}}}var It=Object.keys,Dt=Array.isArray,Ct="undefined"!=typeof self?self:"undefined"!=typeof window?window:global;function Tt(t,e){return"object"!=typeof e||It(e).forEach(function(n){t[n]=e[n]}),t}var Kt=Object.getPrototypeOf,Ft={}.hasOwnProperty;function Bt(n,t){return Ft.call(n,t)}function Mt(t,e){"function"==typeof e&&(e=e(Kt(t))),It(e).forEach(function(n){Rt(t,n,e[n])})}var Nt=Object.defineProperty;function Rt(n,t,e,r){Nt(n,t,Tt(e&&Bt(e,"get")&&"function"==typeof e.get?{get:e.get,set:e.set,configurable:!0}:{value:e,configurable:!0,writable:!0},r))}function qt(t){return{from:function(n){return t.prototype=Object.create(n.prototype),Rt(t.prototype,"constructor",t),{extend:Mt.bind(null,t.prototype)}}}}var Ut=Object.getOwnPropertyDescriptor;var Lt=[].slice;function zt(n,t,e){return Lt.call(n,t,e)}function Vt(n,t){return t(n)}function Wt(n){if(!n)throw new Error("Assertion Failed")}function Gt(n){Ct.setImmediate?setImmediate(n):setTimeout(n,0)}function Qt(n,i){return n.reduce(function(n,t,e){var r=i(t,e);return r&&(n[r[0]]=r[1]),n},{})}function Ht(n,t){return function(){try{n.apply(this,arguments)}catch(n){t(n)}}}function Jt(n,t,e){try{n.apply(null,e)}catch(n){t&&t(n)}}function Yt(n,t){if(Bt(n,t))return n[t];if(!t)return n;if("string"!=typeof t){for(var e=[],r=0,i=t.length;r<i;++r){var o=Yt(n,t[r]);e.push(o)}return e}var u=t.indexOf(".");if(-1!==u){var a=n[t.substr(0,u)];return void 0===a?void 0:Yt(a,t.substr(u+1))}}function Xt(n,t,e){if(n&&void 0!==t&&!("isFrozen"in Object&&Object.isFrozen(n)))if("string"!=typeof t&&"length"in t){Wt("string"!=typeof e&&"length"in e);for(var r=0,i=t.length;r<i;++r)Xt(n,t[r],e[r])}else{var o,u,a=t.indexOf(".");-1!==a?(o=t.substr(0,a),""===(u=t.substr(a+1))?void 0===e?delete n[o]:n[o]=e:Xt(n[o]||(n[o]={}),u,e)):void 0===e?delete n[t]:n[t]=e}}function $t(n){var t={};for(var e in n)Bt(n,e)&&(t[e]=n[e]);return t}var Zt=[].concat;function ne(n){return Zt.apply([],n)}var te="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(ne([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(n){return n+t+"Array"})}))).filter(function(n){return Ct[n]}).map(function(n){return Ct[n]});function ee(n){if(!n||"object"!=typeof n)return n;var t;if(Dt(n)){t=[];for(var e=0,r=n.length;e<r;++e)t.push(ee(n[e]))}else if(0<=te.indexOf(n.constructor))t=n;else for(var i in t=n.constructor?Object.create(n.constructor.prototype):{},n)Bt(n,i)&&(t[i]=ee(n[i]));return t}function re(r,i,o,u){return o=o||{},u=u||"",It(r).forEach(function(n){var t,e;Bt(i,n)?(t=r[n],e=i[n],"object"==typeof t&&"object"==typeof e&&t&&e&&""+t.constructor==""+e.constructor?re(t,e,o,u+n+"."):t!==e&&(o[u+n]=i[n])):o[u+n]=void 0}),It(i).forEach(function(n){Bt(r,n)||(o[u+n]=i[n])}),o}var ie="undefined"!=typeof Symbol&&Symbol.iterator,oe=ie?function(n){var t;return null!=n&&(t=n[ie])&&t.apply(n)}:function(){return null},ue={};function ae(n){var t,e,r,i,o=arguments;if(1===arguments.length){if(Dt(n))return n.slice();if(this===ue&&"string"==typeof n)return[n];if(i=oe(n)){for(e=[];!(r=i.next()).done;)e.push(r.value);return e}if(null==n)return[n];if("number"!=typeof(t=n.length))return[n];for(e=new Array(t);t--;)e[t]=n[t];return e}for(t=arguments.length,e=new Array(t);t--;)e[t]=o[t];return e}var ce="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function se(n,t){ce=n,fe=t}var fe=function(){return!0},le=!new Error("").stack;function he(){if(le)try{throw new Error}catch(n){return n}return new Error}function de(n,t){var e=n.stack;return e?(t=t||0,0===e.indexOf(n.name)&&(t+=(n.name+n.message).split("\n").length),e.split("\n").slice(t).filter(fe).map(function(n){return"\n"+n}).join("")):""}var pe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ve=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(pe),ye={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function ge(n,t){this._e=he(),this.name=n,this.message=t}function me(n,t,e,r){this._e=he(),this.failures=t,this.failedKeys=r,this.successCount=e}function be(n,t){this._e=he(),this.name="BulkError",this.failures=t,this.message=n+". Errors: "+t.map(function(n){return n.toString()}).filter(function(n,t,e){return e.indexOf(n)===t}).join("\n")}qt(ge).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+de(this._e,2))}},toString:function(){return this.name+": "+this.message}}),qt(me).from(ge),qt(be).from(ge);var we=ve.reduce(function(n,t){return n[t]=t+"Error",n},{}),_e=ge,ke=ve.reduce(function(n,e){var r=e+"Error";function t(n,t){this._e=he(),this.name=r,n?"string"==typeof n?(this.message=n,this.inner=t||null):"object"==typeof n&&(this.message=n.name+" "+n.message,this.inner=n):(this.message=ye[e]||r,this.inner=null)}return qt(t).from(_e),n[e]=t,n},{});ke.Syntax=SyntaxError,ke.Type=TypeError,ke.Range=RangeError;var xe=pe.reduce(function(n,t){return n[t+"Error"]=ke[t],n},{});var Se=ve.reduce(function(n,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(n[t+"Error"]=ke[t]),n},{});function Oe(){}function je(n){return n}function Pe(t,e){return null==t||t===je?e:function(n){return e(t(n))}}function Ee(n,t){return function(){n.apply(this,arguments),t.apply(this,arguments)}}function Ae(i,o){return i===Oe?o:function(){var n=i.apply(this,arguments);void 0!==n&&(arguments[0]=n);var t=this.onsuccess,e=this.onerror;this.onsuccess=null,this.onerror=null;var r=o.apply(this,arguments);return t&&(this.onsuccess=this.onsuccess?Ee(t,this.onsuccess):t),e&&(this.onerror=this.onerror?Ee(e,this.onerror):e),void 0!==r?r:n}}function Ie(e,r){return e===Oe?r:function(){e.apply(this,arguments);var n=this.onsuccess,t=this.onerror;this.onsuccess=this.onerror=null,r.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Ee(n,this.onsuccess):n),t&&(this.onerror=this.onerror?Ee(t,this.onerror):t)}}function De(o,u){return o===Oe?u:function(n){var t=o.apply(this,arguments);Tt(n,t);var e=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var i=u.apply(this,arguments);return e&&(this.onsuccess=this.onsuccess?Ee(e,this.onsuccess):e),r&&(this.onerror=this.onerror?Ee(r,this.onerror):r),void 0===t?void 0===i?void 0:i:Tt(t,i)}}function Ce(n,t){return n===Oe?t:function(){return!1!==t.apply(this,arguments)&&n.apply(this,arguments)}}function Te(o,u){return o===Oe?u:function(){var n=arguments,t=o.apply(this,arguments);if(t&&"function"==typeof t.then){for(var e=this,r=arguments.length,i=new Array(r);r--;)i[r]=n[r];return t.then(function(){return u.apply(e,i)})}return u.apply(this,arguments)}}Se.ModifyError=me,Se.DexieError=ge,Se.BulkError=be;var Ke={},Fe=100,Be=7,Me=function(){try{return new Function("let F=async ()=>{},p=F();return [p,Object.getPrototypeOf(p),Promise.resolve(),F.constructor];")()}catch(n){var t=Ct.Promise;return t?[t.resolve(),t.prototype,t.resolve()]:[]}}(),Ne=Me[0],Re=Me[1],qe=Me[2],Ue=Re&&Re.then,Le=Ne&&Ne.constructor,ze=Me[3],Ve=!!qe,We=!1,Ge=qe?function(){qe.then(dr)}:Ct.setImmediate?setImmediate.bind(null,dr):Ct.MutationObserver?function(){var n=document.createElement("div");new MutationObserver(function(){dr(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:function(){setTimeout(dr,0)},Qe=function(n,t){er.push([n,t]),Je&&(Ge(),Je=!1)},He=!0,Je=!0,Ye=[],Xe=[],$e=null,Ze=je,nr={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Br,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(n){try{Br(n[0],n[1])}catch(n){}})}},tr=nr,er=[],rr=0,ir=[];function or(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=Oe,this._lib=!1;var t=this._PSD=tr;if(ce&&(this._stackHolder=he(),this._prev=null,this._numPrev=0),"function"!=typeof n){if(n!==Ke)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&cr(this,this._value))}this._state=null,this._value=null,++t.ref,function t(r,n){try{n(function(e){if(null===r._state){if(e===r)throw new TypeError("A promise cannot be resolved with itself.");var n=r._lib&&pr();e&&"function"==typeof e.then?t(r,function(n,t){e instanceof or?e._then(n,t):e.then(n,t)}):(r._state=!0,r._value=e,sr(r)),n&&vr()}},cr.bind(null,r))}catch(n){cr(r,n)}}(this,n)}var ur={get:function(){var u=tr,t=xr;function n(e,r){var i=this,o=!u.global&&(u!==tr||t!==xr);o&&Pr();var n=new or(function(n,t){fr(i,new ar(Tr(e,u,o),Tr(r,u,o),n,t,u))});return ce&&hr(n,this),n}return n.prototype=Ke,n},set:function(n){Rt(this,"then",n&&n.prototype===Ke?ur:{get:function(){return n},set:ur.set})}};function ar(n,t,e,r,i){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof t?t:null,this.resolve=e,this.reject=r,this.psd=i}function cr(t,e){var n,r;Xe.push(e),null===t._state&&(n=t._lib&&pr(),e=Ze(e),t._state=!1,t._value=e,ce&&null!==e&&"object"==typeof e&&!e._promise&&Jt(function(){var n=function n(t,e){var r;return Ut(t,e)||(r=Kt(t))&&n(r,e)}(e,"stack");e._promise=t,Rt(e,"stack",{get:function(){return We?n&&(n.get?n.get.apply(e):n.value):t.stack}})}),r=t,Ye.some(function(n){return n._value===r._value})||Ye.push(r),sr(t),n&&vr())}function sr(n){var t=n._listeners;n._listeners=[];for(var e=0,r=t.length;e<r;++e)fr(n,t[e]);var i=n._PSD;--i.ref||i.finalize(),0===rr&&(++rr,Qe(function(){0==--rr&&yr()},[]))}function fr(n,t){if(null!==n._state){var e=n._state?t.onFulfilled:t.onRejected;if(null===e)return(n._state?t.resolve:t.reject)(n._value);++t.psd.ref,++rr,Qe(lr,[e,n,t])}else n._listeners.push(t)}function lr(n,t,e){try{var r,i=($e=t)._value;t._state?r=n(i):(Xe.length&&(Xe=[]),r=n(i),-1===Xe.indexOf(i)&&function(n){var t=Ye.length;for(;t;)if(Ye[--t]._value===n._value)return Ye.splice(t,1)}(t)),e.resolve(r)}catch(n){e.reject(n)}finally{$e=null,0==--rr&&yr(),--e.psd.ref||e.psd.finalize()}}function hr(n,t){var e=t?t._numPrev+1:0;e<Fe&&(n._prev=t,n._numPrev=e)}function dr(){pr()&&vr()}function pr(){var n=He;return Je=He=!1,n}function vr(){var n,t,e;do{for(;0<er.length;)for(n=er,er=[],e=n.length,t=0;t<e;++t){var r=n[t];r[0].apply(null,r[1])}}while(0<er.length);Je=He=!0}function yr(){var n=Ye;Ye=[],n.forEach(function(n){n._PSD.onunhandled.call(null,n._value,n)});for(var t=ir.slice(0),e=t.length;e;)t[--e]()}function gr(n){return new or(Ke,!1,n)}function mr(e,r){var i=tr;return function(){var n=pr(),t=tr;try{return Ir(i,!0),e.apply(this,arguments)}catch(n){r&&r(n)}finally{Ir(t,!1),n&&vr()}}}Mt(or.prototype,{then:ur,_then:function(n,t){fr(this,new ar(null,null,n,t,tr))},catch:function(n){if(1===arguments.length)return this.then(null,n);var t=n,e=arguments[1];return"function"==typeof t?this.then(null,function(n){return(n instanceof t?e:gr)(n)}):this.then(null,function(n){return(n&&n.name===t?e:gr)(n)})},finally:function(t){return this.then(function(n){return t(),n},function(n){return t(),gr(n)})},stack:{get:function(){if(this._stack)return this._stack;try{We=!0;var n=function n(t,e,r){if(e.length===r)return e;var i="";{var o,u,a;!1===t._state&&(null!=(o=t._value)?(u=o.name||"Error",a=o.message||o,i=de(o,0)):(u=o,a=""),e.push(u+(a?": "+a:"")+i))}ce&&((i=de(t._stackHolder,2))&&-1===e.indexOf(i)&&e.push(i),t._prev&&n(t._prev,e,r));return e}(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=n),n}finally{We=!1}}},timeout:function(r,i){var o=this;return r<1/0?new or(function(n,t){var e=setTimeout(function(){return t(new ke.Timeout(i))},r);o.then(n,t).finally(clearTimeout.bind(null,e))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&Rt(or.prototype,Symbol.toStringTag,"Promise"),nr.env=Dr(),Mt(or,{all:function(){var o=ae.apply(null,arguments).map(Er);return new or(function(e,r){0===o.length&&e([]);var i=o.length;o.forEach(function(n,t){return or.resolve(n).then(function(n){o[t]=n,--i||e(o)},r)})})},resolve:function(e){if(e instanceof or)return e;if(e&&"function"==typeof e.then)return new or(function(n,t){e.then(n,t)});var n=new or(Ke,!0,e);return hr(n,$e),n},reject:gr,race:function(){var n=ae.apply(null,arguments).map(Er);return new or(function(t,e){n.map(function(n){return or.resolve(n).then(t,e)})})},PSD:{get:function(){return tr},set:function(n){return tr=n}},newPSD:Or,usePSD:Cr,scheduler:{get:function(){return Qe},set:function(n){Qe=n}},rejectionMapper:{get:function(){return Ze},set:function(n){Ze=n}},follow:function(i,e){return new or(function(n,t){return Or(function(e,r){var n=tr;n.unhandleds=[],n.onunhandled=r,n.finalize=Ee(function(){var t,n=this;t=function(){0===n.unhandleds.length?e():r(n.unhandleds[0])},ir.push(function n(){t(),ir.splice(ir.indexOf(n),1)}),++rr,Qe(function(){0==--rr&&yr()},[])},n.finalize),i()},e,n,t)})}});var br={awaits:0,echoes:0,id:0},wr=0,_r=[],kr=0,xr=0,Sr=0;function Or(n,t,e,r){var i=tr,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++Sr;var u=nr.env;o.env=Ve?{Promise:or,PromiseProp:{value:or,configurable:!0,writable:!0},all:or.all,race:or.race,resolve:or.resolve,reject:or.reject,nthen:Kr(u.nthen,o),gthen:Kr(u.gthen,o)}:{},t&&Tt(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Cr(o,n,e,r);return 0===o.ref&&o.finalize(),a}function jr(){return br.id||(br.id=++wr),++br.awaits,br.echoes+=Be,br.id}function Pr(n){!br.awaits||n&&n!==br.id||(0==--br.awaits&&(br.id=0),br.echoes=br.awaits*Be)}function Er(n){return br.echoes&&n&&n.constructor===Le?(jr(),n.then(function(n){return Pr(),n},function(n){return Pr(),Mr(n)})):n}function Ar(){var n=_r[_r.length-1];_r.pop(),Ir(n,!1)}function Ir(n,t){var e,r,i,o=tr;(t?!br.echoes||kr++&&n===tr:!kr||--kr&&n===tr)||(e=t?function(n){++xr,br.echoes&&0!=--br.echoes||(br.echoes=br.id=0),_r.push(tr),Ir(n,!0)}.bind(null,n):Ar,Ue.call(Ne,e)),n!==tr&&(tr=n,o===nr&&(nr.env=Dr()),Ve&&(r=nr.env.Promise,i=n.env,Re.then=i.nthen,r.prototype.then=i.gthen,(o.global||n.global)&&(Object.defineProperty(Ct,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject)))}function Dr(){var n=Ct.Promise;return Ve?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(Ct,"Promise"),all:n.all,race:n.race,resolve:n.resolve,reject:n.reject,nthen:Re.then,gthen:n.prototype.then}:{}}function Cr(n,t,e,r,i){var o=tr;try{return Ir(n,!0),t(e,r,i)}finally{Ir(o,!1)}}function Tr(t,e,r){return"function"!=typeof t?t:function(){var n=tr;r&&jr(),Ir(e,!0);try{return t.apply(this,arguments)}finally{Ir(n,!1)}}}function Kr(e,r){return function(n,t){return e.call(this,Tr(n,r,!1),Tr(t,r,!1))}}var Fr="unhandledrejection";function Br(n,t){var e;try{e=t.onuncatched(n)}catch(n){}if(!1!==e)try{var r,i={promise:t,reason:n};if(Ct.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Fr,!0,!0),Tt(r,i)):Ct.CustomEvent&&Tt(r=new CustomEvent(Fr,{detail:i}),i),r&&Ct.dispatchEvent&&(dispatchEvent(r),!Ct.PromiseRejectionEvent&&Ct.onunhandledrejection))try{Ct.onunhandledrejection(r)}catch(n){}r.defaultPrevented||console.warn("Unhandled rejection: "+(n.stack||n))}catch(n){}}var Mr=or.reject;function Nr(o){var n=arguments,u={},t=function(n,t){var e=arguments;if(t){for(var r=arguments.length,i=new Array(r-1);--r;)i[r-1]=e[r];return u[n].subscribe.apply(null,i),o}if("string"==typeof n)return u[n]};t.addEventType=a;for(var e=1,r=arguments.length;e<r;++e)a(n[e]);return t;function a(n,e,r){if("object"!=typeof n){var i;e=e||Ce;var o={subscribers:[],fire:r=r||Oe,subscribe:function(n){-1===o.subscribers.indexOf(n)&&(o.subscribers.push(n),o.fire=e(o.fire,n))},unsubscribe:function(t){o.subscribers=o.subscribers.filter(function(n){return n!==t}),o.fire=o.subscribers.reduce(e,r)}};return u[n]=t[n]=o}It(i=n).forEach(function(n){var t=i[n];if(Dt(t))a(n,i[n][0],i[n][1]);else{if("asap"!==t)throw new ke.InvalidArgument("Invalid event config");var r=a(n,je,function(){for(var n=arguments,t=arguments.length,e=new Array(t);t--;)e[t]=n[t];r.subscribers.forEach(function(n){Gt(function(){n.apply(null,e)})})})}})}}function Rr(n){return!/(dexie\.js|dexie\.min\.js)/.test(n)}var qr,Ur="{version}",Lr=String.fromCharCode(65535),zr=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(n){return Lr}}(),Vr=-1/0,Wr="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Gr="String expected.",Qr=[],Hr="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Jr=Hr,Yr=Hr;function Xr(o,n){var t,e,l,r,i,u=Xr.dependencies,a=Tt({addons:Xr.addons,autoOpen:!0,indexedDB:u.indexedDB,IDBKeyRange:u.IDBKeyRange},n),c=a.addons,s=a.autoOpen,f=a.indexedDB,m=a.IDBKeyRange,h=this._dbSchema={},d=[],p=[],v={},y=null,g=null,b=!1,w=null,_=!1,k="readonly",x="readwrite",S=this,O=new or(function(n){t=n}),j=new or(function(n,t){e=t}),P=!0,E=!!ci(f);function A(n){this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function I(n,t,e){var r=S._createTransaction(x,p,h);r.create(t),r._completion.catch(e);var i=r._reject.bind(r);Or(function(){tr.trans=r,0===n?(It(h).forEach(function(n){D(t,n,h[n].primKey,h[n].indexes)}),or.follow(function(){return S.on.populate.fire(r)}).catch(i)):function(t,i,o){var e=[],n=d.filter(function(n){return n._cfg.version===t})[0];if(!n)throw new ke.Upgrade("Dexie specification of currently installed DB version is missing");h=S._dbSchema=n._cfg.dbschema;var u=!1;return d.filter(function(n){return n._cfg.version>t}).forEach(function(r){e.push(function(){var n=h,t=r._cfg.dbschema;J(n,o),J(t,o);var e=function(n,t){var e={del:[],add:[],change:[]};for(var r in n)t[r]||e.del.push(r);for(r in t){var i=n[r],o=t[r];if(i){var u={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(i.primKey.src!==o.primKey.src)u.recreate=!0,e.change.push(u);else{var a=i.idxByName,c=o.idxByName;for(var s in a)c[s]||u.del.push(s);for(s in c){var f=a[s],l=c[s];f?f.src!==l.src&&u.change.push(l):u.add.push(l)}(0<u.del.length||0<u.add.length||0<u.change.length)&&e.change.push(u)}}else e.add.push([r,o])}return e}(n,h=S._dbSchema=t);if(e.add.forEach(function(n){D(o,n[0],n[1].primKey,n[1].indexes)}),e.change.forEach(function(n){if(n.recreate)throw new ke.Upgrade("Not yet support for changing primary key");var t=o.objectStore(n.name);n.add.forEach(function(n){C(t,n)}),n.change.forEach(function(n){t.deleteIndex(n.name),C(t,n)}),n.del.forEach(function(n){t.deleteIndex(n)})}),r._cfg.contentUpgrade)return u=!0,or.follow(function(){r._cfg.contentUpgrade(i)})}),e.push(function(n){u&&Jr||function(n,t){for(var e=0;e<t.db.objectStoreNames.length;++e){var r=t.db.objectStoreNames[e];null==n[r]&&t.db.deleteObjectStore(r)}}(r._cfg.dbschema,n)})}),function n(){return e.length?or.resolve(e.shift()(i.idbtrans)).then(n):or.resolve()}().then(function(){var t,e;e=o,It(t=h).forEach(function(n){e.db.objectStoreNames.contains(n)||D(e,n,t[n].primKey,t[n].indexes)})})}(n,r,t).catch(i)})}function D(n,t,e,r){var i=n.db.createObjectStore(t,e.keyPath?{keyPath:e.keyPath,autoIncrement:e.auto}:{autoIncrement:e.auto});return r.forEach(function(n){C(i,n)}),i}function C(n,t){n.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function T(n,t,e){this.name=n,this.schema=t,this._tx=e,this.hook=v[n]?v[n].hook:Nr(null,{creating:[Ae,Oe],reading:[Pe,je],updating:[De,Oe],deleting:[Ie,Oe]})}function K(t,e,n){return(n?ei:ni)(function(n){t.push(n),e&&e()})}function F(s,f,l,h,d){return new or(function(r,n){var i=l.length,o=i-1;if(0===i)return r();if(h){var u,a=ei(n),c=Zr(null);Jt(function(){for(var n=0;n<i;++n){u={onsuccess:null,onerror:null};var t=l[n];d.call(u,t[0],t[1],f);var e=s.delete(t[0]);e._hookCtx=u,e.onerror=a,e.onsuccess=n===o?Zr(r):c}},function(n){throw u.onerror&&u.onerror(n),n})}else for(var t=0;t<i;++t){var e=s.delete(l[t]);e.onerror=ni(n),t===o&&(e.onsuccess=mr(function(){return r()}))}})}function B(n,t,e,r){var i=this;this.db=S,this.mode=n,this.storeNames=t,this.idbtrans=null,this.on=Nr(this,"complete","error","abort"),this.parent=r||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new or(function(n,t){i._resolve=n,i._reject=t}),this._completion.then(function(){i.active=!1,i.on.complete.fire()},function(n){var t=i.active;return i.active=!1,i.on.error.fire(n),i.parent?i.parent._reject(n):t&&i.idbtrans&&i.idbtrans.abort(),Mr(n)})}function M(n,t,e){this._ctx={table:n,index:":id"===t?null:t,or:e}}function N(n,t){var e=null,r=null;if(t)try{e=t()}catch(n){r=n}var i=n._ctx,o=i.table;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:e,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:o.hook.reading.fire}}function R(n,t){return!(n.filter||n.algorithm||n.or)&&(t?n.justLimit:!n.replayFilter)}function q(n,t){return n._cfg.version-t._cfg.version}function U(n,t,r){t.forEach(function(t){var e=r[t];n.forEach(function(n){t in n||(n===B.prototype||n instanceof B?Rt(n,t,{get:function(){return this.table(t)}}):n[t]=new T(t,e))})})}function L(e,r,i,o,u,a){var c=mr(a?function(n,t,e){return i(a(n),t,e)}:i,u);e.onerror||(e.onerror=ni(u)),e.onsuccess=Ht(r?function(){var t,n=e.result;n?(t=function(){n.continue()},r(n,function(n){t=n},o,u)&&c(n.value,n,function(n){t=n}),t()):o()}:function(){var t,n=e.result;n?(t=function(){n.continue()},c(n.value,n,function(n){t=n}),t()):o()},u)}function z(n,t){return f.cmp(n,t)}function V(n,t){return f.cmp(n,t)}function W(n,t){return f.cmp(t,n)}function G(n,t){return n<t?-1:n===t?0:1}function Q(n,t){return t<n?-1:n===t?0:1}function H(n,t){return n?t?function(){return n.apply(this,arguments)&&t.apply(this,arguments)}:n:t}function J(n,t){for(var e=t.db.objectStoreNames,r=0;r<e.length;++r){var i=e[r],o=t.objectStore(i);l="getAll"in o;for(var u=0;u<o.indexNames.length;++u){var a,c=o.indexNames[u],s=o.index(c).keyPath,f="string"==typeof s?s:"["+zt(s).join("+")+"]";!n[i]||(a=n[i].idxByName[f])&&(a.name=c)}}/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Ct.WorkerGlobalScope&&Ct instanceof Ct.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(l=!1)}function Y(t){S.on("blocked").fire(t),Qr.filter(function(n){return n.name===S.name&&n!==S&&!n._vcFired}).map(function(n){return n.on("versionchange").fire(t)})}this.version=function(t){if(y||b)throw new ke.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var n=d.filter(function(n){return n._cfg.version===t})[0];return n||(n=new A(t),d.push(n),d.sort(q),P=!1,n)},Tt(A.prototype,{stores:function(n){this._cfg.storesSource=this._cfg.storesSource?Tt(this._cfg.storesSource,n):n;var t={};d.forEach(function(n){Tt(t,n._cfg.storesSource)});var e=this._cfg.dbschema={};return this._parseStoresSpec(t,e),h=S._dbSchema=e,[v,S,B.prototype].forEach(function(n){for(var t in n)n[t]instanceof T&&delete n[t]}),U([v,S,B.prototype,this._cfg.tables],It(e),e),p=It(e),this},upgrade:function(n){return this._cfg.contentUpgrade=n,this},_parseStoresSpec:function(u,a){It(u).forEach(function(n){if(null!==u[n]){var t={},e=(i=u[n],o=[],i.split(",").forEach(function(n){var t=(n=n.trim()).replace(/([&*]|\+\+)/g,""),e=/^\[/.test(t)?t.match(/^\[(.*)\]$/)[1].split("+"):t;o.push(new oi(t,e||null,/\&/.test(n),/\*/.test(n),/\+\+/.test(n),Dt(e),/\./.test(n)))}),o),r=e.shift();if(r.multi)throw new ke.Schema("Primary key cannot be multi-valued");r.keyPath&&Xt(t,r.keyPath,r.auto?0:r.keyPath),e.forEach(function(n){if(n.auto)throw new ke.Schema("Only primary key can be marked as autoIncrement (++)");if(!n.keyPath)throw new ke.Schema("Index must have a name and cannot be an empty string");Xt(t,n.keyPath,n.compound?n.keyPath.map(function(){return""}):"")}),a[n]=new ui(n,r,e,t)}var i,o})}}),this._allTables=v,this._createTransaction=function(n,t,e,r){return new B(n,t,0,r)},this._whenReady=function(n){return _||tr.letThrough?n():new or(function(n,t){if(!b){if(!s)return void t(new ke.DatabaseClosed);S.open().catch(Oe)}O.then(n,t)}).then(n)},this.verno=0,this.open=function(){if(b||y)return O.then(function(){return g?Mr(g):S});ce&&(j._stackHolder=he()),_=!(b=!0);var n=t,i=g=null;return or.race([j,new or(function(n,e){if(!f)throw new ke.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var r=P?f.open(o):f.open(o,Math.round(10*S.verno));if(!r)throw new ke.MissingAPI("IndexedDB API not available");r.onerror=ni(e),r.onblocked=mr(Y),r.onupgradeneeded=mr(function(n){var t;i=r.transaction,P&&!S._allowEmptyDB?(r.onerror=ri,i.abort(),r.result.close(),(t=f.deleteDatabase(o)).onsuccess=t.onerror=mr(function(){e(new ke.NoSuchDatabase("Database "+o+" doesnt exist"))})):(i.onerror=ni(e),I((n.oldVersion>Math.pow(2,62)?0:n.oldVersion)/10,i,e))},e),r.onsuccess=mr(function(){if(i=null,y=r.result,Qr.push(S),P)!function(){if(S.verno=y.version/10,S._dbSchema=h={},0===(p=zt(y.objectStoreNames,0)).length)return;var s=y.transaction(ai(p),"readonly");p.forEach(function(n){for(var t=s.objectStore(n),e=(u=t.keyPath)&&"string"==typeof u&&-1!==u.indexOf("."),r=new oi(u,u||"",!1,!1,!!t.autoIncrement,u&&"string"!=typeof u,e),i=[],o=0;o<t.indexNames.length;++o){var u,a=t.index(t.indexNames[o]),e=(u=a.keyPath)&&"string"==typeof u&&-1!==u.indexOf("."),c=new oi(a.name,u,!!a.unique,!!a.multiEntry,!1,u&&"string"!=typeof u,e);i.push(c)}h[n]=new ui(n,r,i,{})}),U([v],It(h),h)}();else if(0<y.objectStoreNames.length)try{J(h,y.transaction(ai(y.objectStoreNames),k))}catch(n){}y.onversionchange=mr(function(n){S._vcFired=!0,S.on("versionchange").fire(n)}),E||"__dbnames"===o||qr.dbnames.put({name:o}).catch(Oe),n()},e)})]).then(function(){return w=[],or.resolve(Xr.vip(S.on.ready.fire)).then(function n(){if(0<w.length){var t=w.reduce(Te,Oe);return w=[],or.resolve(Xr.vip(t)).then(n)}})}).finally(function(){w=null}).then(function(){return b=!1,S}).catch(function(n){try{i&&i.abort()}catch(n){}return b=!1,S.close(),Mr(g=n)}).finally(function(){_=!0,n()})},this.close=function(){var n=Qr.indexOf(S);if(0<=n&&Qr.splice(n,1),y){try{y.close()}catch(n){}y=null}s=!1,g=new ke.DatabaseClosed,b&&e(g),O=new or(function(n){t=n}),j=new or(function(n,t){e=t})},this.delete=function(){var r=0<arguments.length;return new or(function(t,e){if(r)throw new ke.InvalidArgument("Arguments not allowed in db.delete()");function n(){S.close();var n=f.deleteDatabase(o);n.onsuccess=mr(function(){E||qr.dbnames.delete(o).catch(Oe),t()}),n.onerror=ni(e),n.onblocked=Y}b?O.then(n):n()})},this.backendDB=function(){return y},this.isOpen=function(){return null!==y},this.hasBeenClosed=function(){return g&&g instanceof ke.DatabaseClosed},this.hasFailed=function(){return null!==g},this.dynamicallyOpened=function(){return P},this.name=o,Mt(this,{tables:{get:function(){return It(v).map(function(n){return v[n]})}}}),this.on=Nr(this,"populate","blocked","versionchange",{ready:[Te,Oe]}),this.on.ready.subscribe=Vt(this.on.ready.subscribe,function(e){return function(t,n){Xr.vip(function(){_?(g||or.resolve().then(t),n&&e(t)):w?(w.push(t),n&&e(t)):(e(t),n||e(function n(){S.on.ready.unsubscribe(t),S.on.ready.unsubscribe(n)}))})}}),this.transaction=function(){var n=function(n,t,e){var r=arguments,i=arguments.length;if(i<2)throw new ke.InvalidArgument("Too few arguments");var o=new Array(i-1);for(;--i;)o[i-1]=r[i];e=o.pop();var u=ne(o);return[n,u,e]}.apply(this,arguments);return this._transaction.apply(this,n)},this._transaction=function(o,n,u){var a=tr.trans;a&&a.db===S&&-1===o.indexOf("!")||(a=null);var t=-1!==o.indexOf("?");o=o.replace("!","").replace("?","");try{var c=n.map(function(n){var t=n instanceof T?n.name:n;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t});if("r"==o||o==k)o=k;else{if("rw"!=o&&o!=x)throw new ke.InvalidArgument("Invalid transaction mode: "+o);o=x}if(a){if(a.mode===k&&o===x){if(!t)throw new ke.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a=null}a&&c.forEach(function(n){if(a&&-1===a.storeNames.indexOf(n)){if(!t)throw new ke.SubTransaction("Table "+n+" not included in parent transaction.");a=null}}),t&&a&&!a.active&&(a=null)}}catch(e){return a?a._promise(null,function(n,t){t(e)}):Mr(e)}return a?a._promise(o,e,"lock"):tr.trans?Cr(tr.transless,function(){return S._whenReady(e)}):S._whenReady(e);function e(){return or.resolve().then(function(){var t,n=tr.transless||tr,e=S._createTransaction(o,c,h,a),r={trans:e,transless:n};a?e.idbtrans=a.idbtrans:e.create(),u.constructor===ze&&jr();var i=or.follow(function(){var n;(t=u.call(e,e))&&(t.constructor===Le?(n=Pr.bind(null,null),t.then(n,n)):"function"==typeof t.next&&"function"==typeof t.throw&&(t=ii(t)))},r);return(t&&"function"==typeof t.then?or.resolve(t).then(function(n){return e.active?n:Mr(new ke.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):i.then(function(){return t})).then(function(n){return a&&e._resolve(),e._completion.then(function(){return n})}).catch(function(n){return e._reject(n),Mr(n)})})}},this.table=function(n){if(!Bt(v,n))throw new ke.InvalidTable("Table "+n+" does not exist");return v[n]},Mt(T.prototype,{_trans:function(n,t,e){var r=this._tx||tr.trans;return r&&r.db===S?r===tr.trans?r._promise(n,t,e):Or(function(){return r._promise(n,t,e)},{trans:r,transless:tr.transless||tr}):function n(t,e,r){if(_||tr.letThrough){var i=S._createTransaction(t,e,h);try{i.create()}catch(n){return Mr(n)}return i._promise(t,function(n,t){return Or(function(){return tr.trans=i,r(n,t,i)})}).then(function(n){return i._completion.then(function(){return n})})}if(!b){if(!s)return Mr(new ke.DatabaseClosed);S.open().catch(Oe)}return O.then(function(){return n(t,e,r)})}(n,[this.name],t)},_idbstore:function(n,r,t){var i=this.name;return this._trans(n,function(n,t,e){if(-1===e.storeNames.indexOf(i))throw new ke.NotFound("Table"+i+" not part of transaction");return r(n,t,e.idbtrans.objectStore(i),e)},t)},get:function(i,n){if(i&&i.constructor===Object)return this.where(i).first(n);var o=this;return this._idbstore(k,function(n,t,e){var r=e.get(i);r.onerror=ni(t),r.onsuccess=mr(function(){n(o.hook.reading.fire(r.result))},t)}).then(n)},where:function(e){if("string"==typeof e)return new M(this,e);if(Dt(e))return new M(this,"["+e.join("+")+"]");var r=It(e);if(1===r.length)return this.where(r[0]).equals(e[r[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(t){return t.compound&&r.every(function(n){return 0<=t.keyPath.indexOf(n)})&&t.keyPath.every(function(n){return 0<=r.indexOf(n)})})[0];if(n&&zr!==Lr)return this.where(n.name).equals(n.keyPath.map(function(n){return e[n]}));n||console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a compound index ["+r.join("+")+"]");var i=this.schema.idxByName,t=r.reduce(function(n,t){return[n[0]||i[t],n[0]||!i[t]?H(n[1],function(n){return""+Yt(n,t)==""+e[t]}):n[1]]},[null,null]),o=t[0];return o?this.where(o.name).equals(e[o.keyPath]).filter(t[1]):n?this.filter(t[1]):this.where(r).equals("")},count:function(n){return this.toCollection().count(n)},offset:function(n){return this.toCollection().offset(n)},limit:function(n){return this.toCollection().limit(n)},reverse:function(){return this.toCollection().reverse()},filter:function(n){return this.toCollection().and(n)},each:function(n){return this.toCollection().each(n)},toArray:function(n){return this.toCollection().toArray(n)},orderBy:function(n){return new N(new M(this,Dt(n)?"["+n.join("+")+"]":n))},toCollection:function(){return new N(new M(this))},mapToClass:function(r,n){this.schema.mappedClass=r;var t=Object.create(r.prototype);n&&$r(t,n),this.schema.instanceTemplate=t;function e(n){if(!n)return n;var t=Object.create(r.prototype);for(var e in n)if(Bt(n,e))try{t[e]=n[e]}catch(n){}return t}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),r},defineClass:function(n){return this.mapToClass(Xr.defineClass(n),n)},bulkDelete:function(i){return this.hook.deleting.fire===Oe?this._idbstore(x,function(n,t,e,r){n(F(e,r,i,!1,Oe))}):this.where(":id").anyOf(i).delete().then(function(){})},bulkPut:function(d,p){var v=this;return this._idbstore(x,function(t,e,r){if(!r.keyPath&&!v.schema.primKey.auto&&!p)throw new ke.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(r.keyPath&&p)throw new ke.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(p&&p.length!==d.length)throw new ke.InvalidArgument("Arguments objects and keys must have the same length");if(0===d.length)return t();function i(n){0===u.length?t(n):e(new be(v.name+".bulkPut(): "+u.length+" of "+a+" operations failed",u))}var n,o,u=[],a=d.length,c=v;if(v.hook.creating.fire===Oe&&v.hook.updating.fire===Oe){o=K(u);for(var s=0,f=d.length;s<f;++s)(n=p?r.put(d[s],p[s]):r.put(d[s])).onerror=o;n.onerror=K(u,i),n.onsuccess=ti(i)}else{var l=p||r.keyPath&&d.map(function(n){return Yt(n,r.keyPath)}),h=l&&Qt(l,function(n,t){return null!=n&&[n,d[t]]});(l?c.where(":id").anyOf(l.filter(function(n){return null!=n})).modify(function(){this.value=h[this.primKey],h[this.primKey]=null}).catch(me,function(n){u=n.failures}).then(function(){for(var n=[],t=p&&[],e=l.length-1;0<=e;--e){var r=l[e];null!=r&&!h[r]||(n.push(d[e]),p&&t.push(r),null!=r&&(h[r]=null))}return n.reverse(),p&&t.reverse(),c.bulkAdd(n,t)}).then(function(n){var t=l[l.length-1];return null!=t?t:n}):c.bulkAdd(d)).then(i).catch(be,function(n){u=u.concat(n.failures),i()}).catch(e)}},"locked")},bulkAdd:function(p,v){var y=this,g=this.hook.creating.fire;return this._idbstore(x,function(t,e,u,a){if(!u.keyPath&&!y.schema.primKey.auto&&!v)throw new ke.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(u.keyPath&&v)throw new ke.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(v&&v.length!==p.length)throw new ke.InvalidArgument("Arguments objects and keys must have the same length");if(0===p.length)return t();function n(n){0===r.length?t(n):e(new be(y.name+".bulkAdd(): "+r.length+" of "+i+" operations failed",r))}var c,r=[],i=p.length;if(g!==Oe){var s,f=u.keyPath,l=K(r,null,!0),h=Zr(null);Jt(function(){for(var n=0,t=p.length;n<t;++n){s={onerror:null,onsuccess:null};var e=v&&v[n],r=p[n],i=v?e:f?Yt(r,f):void 0,o=g.call(s,i,r,a);null==i&&null!=o&&(f?Xt(r=ee(r),f,o):e=o),(c=null!=e?u.add(r,e):u.add(r))._hookCtx=s,n<t-1&&(c.onerror=l,s.onsuccess&&(c.onsuccess=h))}},function(n){throw s.onerror&&s.onerror(n),n}),c.onerror=K(r,n,!0),c.onsuccess=Zr(n)}else{l=K(r);for(var o=0,d=p.length;o<d;++o)(c=v?u.add(p[o],v[o]):u.add(p[o])).onerror=l;c.onerror=K(r,n),c.onsuccess=ti(n)}})},add:function(c,s){var f=this.hook.creating.fire;return this._idbstore(x,function(e,n,r,t){var i,o,u={onsuccess:null,onerror:null};f!==Oe&&(i=null!=s?s:r.keyPath?Yt(c,r.keyPath):void 0,o=f.call(u,i,c,t),null==i&&null!=o&&(r.keyPath?Xt(c,r.keyPath,o):s=o));try{var a=null!=s?r.add(c,s):r.add(c);a._hookCtx=u,a.onerror=ei(n),a.onsuccess=Zr(function(n){var t=r.keyPath;t&&Xt(c,t,n),e(n)})}catch(n){throw u.onerror&&u.onerror(n),n}})},put:function(o,t){var e=this,n=this.hook.creating.fire,r=this.hook.updating.fire;if(n===Oe&&r===Oe)return this._idbstore(x,function(e,n,r){var i=void 0!==t?r.put(o,t):r.put(o);i.onerror=ni(n),i.onsuccess=mr(function(n){var t=r.keyPath;t&&Xt(o,t,n.target.result),e(i.result)})});var i=this.schema.primKey.keyPath,u=void 0!==t?t:i&&Yt(o,i);return null==u?this.add(o):(o=ee(o),this._trans(x,function(){return e.where(":id").equals(u).modify(function(){this.value=o}).then(function(n){return 0===n?e.add(o,t):u})},"locked"))},delete:function(i){return this.hook.deleting.subscribers.length?this.where(":id").equals(i).delete():this._idbstore(x,function(n,t,e){var r=e.delete(i);r.onerror=ni(t),r.onsuccess=mr(function(){n(r.result)})})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(x,function(n,t,e){var r=e.clear();r.onerror=ni(t),r.onsuccess=mr(function(){n(r.result)})})},update:function(t,e){if("object"!=typeof e||Dt(e))throw new ke.InvalidArgument("Modifications must be an object.");if("object"!=typeof t||Dt(t))return this.where(":id").equals(t).modify(e);It(e).forEach(function(n){Xt(t,n,e[n])});var n=Yt(t,this.schema.primKey.keyPath);return void 0===n?Mr(new ke.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(e)}}),Mt(B.prototype,{_lock:function(){return Wt(!tr.global),++this._reculock,1!==this._reculock||tr.global||(tr.lockOwnerFor=this),this},_unlock:function(){if(Wt(!tr.global),0==--this._reculock)for(tr.global||(tr.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var n=this._blockedFuncs.shift();try{Cr(n[1],n[0])}catch(n){}}return this},_locked:function(){return this._reculock&&tr.lockOwnerFor!==this},create:function(t){var e=this;if(!this.mode)return this;if(Wt(!this.idbtrans),!t&&!y)switch(g&&g.name){case"DatabaseClosedError":throw new ke.DatabaseClosed(g);case"MissingAPIError":throw new ke.MissingAPI(g.message,g);default:throw new ke.OpenFailed(g)}if(!this.active)throw new ke.TransactionInactive;return Wt(null===this._completion._state),(t=this.idbtrans=t||y.transaction(ai(this.storeNames),this.mode)).onerror=mr(function(n){ri(n),e._reject(t.error)}),t.onabort=mr(function(n){ri(n),e.active&&e._reject(new ke.Abort(t.error)),e.active=!1,e.on("abort").fire(n)}),t.oncomplete=mr(function(){e.active=!1,e._resolve()}),this},_promise:function(e,r,i){var o=this;if(e===x&&this.mode!==x)return Mr(new ke.ReadOnly("Transaction is readonly"));if(!this.active)return Mr(new ke.TransactionInactive);if(this._locked())return new or(function(n,t){o._blockedFuncs.push([function(){o._promise(e,r,i).then(n,t)},tr])});if(i)return Or(function(){var n=new or(function(n,t){o._lock();var e=r(n,t,o);e&&e.then&&e.then(n,t)});return n.finally(function(){return o._unlock()}),n._lib=!0,n});var n=new or(function(n,t){var e=r(n,t,o);e&&e.then&&e.then(n,t)});return n._lib=!0,n},_root:function(){return this.parent?this.parent._root():this},waitFor:function(n){var t,r=this._root();n=or.resolve(n),r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return n}):(r._waitingFor=n,r._waitingQueue=[],t=r.idbtrans.objectStore(r.storeNames[0]),function n(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(t.get(-1/0).onsuccess=n)}());var i=r._waitingFor;return new or(function(t,e){n.then(function(n){return r._waitingQueue.push(mr(t.bind(null,n)))},function(n){return r._waitingQueue.push(mr(e.bind(null,n)))}).finally(function(){r._waitingFor===i&&(r._waitingFor=null)})})},abort:function(){this.active&&this._reject(new ke.Abort),this.active=!1},tables:{get:(r="Transaction.tables",i=function(){return v},function(){return console.warn(r+" is deprecated. See https://github.com/dfahlander/Dexie.js/wiki/Deprecations. "+de(he(),1)),i.apply(this,arguments)})},table:function(n){return new T(n,S.table(n).schema,this)}}),Mt(M.prototype,function(){function g(n,t,e){var r=n instanceof M?new N(n):n;return r._ctx.error=new(e||TypeError)(t),r}function h(n){return new N(n,function(){return m.only("")}).limit(0)}function t(n,c,e,r){var i,s,f,l,h,d,p,v=e.length;if(!e.every(function(n){return"string"==typeof n}))return g(n,Gr);function t(n){i="next"===n?function(n){return n.toUpperCase()}:function(n){return n.toLowerCase()},s="next"===n?function(n){return n.toLowerCase()}:function(n){return n.toUpperCase()},f="next"===n?G:Q;var t=e.map(function(n){return{lower:s(n),upper:i(n)}}).sort(function(n,t){return f(n.lower,t.lower)});l=t.map(function(n){return n.upper}),h=t.map(function(n){return n.lower}),p="next"===(d=n)?"":r}t("next");var o=new N(n,function(){return m.bound(l[0],h[v-1]+r)});o._ondirectionchange=function(n){t(n)};var y=0;return o._addAlgorithm(function(n,t,e){var r=n.key;if("string"!=typeof r)return!1;var i=s(r);if(c(i,h,y))return!0;for(var o=null,u=y;u<v;++u){var a=function(n,t,e,r,i,o){for(var u=Math.min(n.length,r.length),a=-1,c=0;c<u;++c){var s=t[c];if(s!==r[c])return i(n[c],e[c])<0?n.substr(0,c)+e[c]+e.substr(c+1):i(n[c],r[c])<0?n.substr(0,c)+r[c]+e.substr(c+1):0<=a?n.substr(0,a)+t[a]+e.substr(a+1):null;i(n[c],s)<0&&(a=c)}return u<r.length&&"next"===o?n+e.substr(n.length):u<n.length&&"prev"===o?n.substr(0,e.length):a<0?null:n.substr(0,a)+r[a]+e.substr(a+1)}(r,i,l[u],h[u],f,d);null===a&&null===o?y=u+1:(null===o||0<f(o,a))&&(o=a)}return t(null!==o?function(){n.continue(o+p)}:e),!1}),o}return{between:function(n,t,e,r){e=!1!==e,r=!0===r;try{return 0<z(n,t)||0===z(n,t)&&(e||r)&&(!e||!r)?h(this):new N(this,function(){return m.bound(n,t,!e,!r)})}catch(n){return g(this,Wr)}},equals:function(n){return new N(this,function(){return m.only(n)})},above:function(n){return new N(this,function(){return m.lowerBound(n,!0)})},aboveOrEqual:function(n){return new N(this,function(){return m.lowerBound(n)})},below:function(n){return new N(this,function(){return m.upperBound(n,!0)})},belowOrEqual:function(n){return new N(this,function(){return m.upperBound(n)})},startsWith:function(n){return"string"!=typeof n?g(this,Gr):this.between(n,n+Lr,!0,!0)},startsWithIgnoreCase:function(n){return""===n?this.startsWith(n):t(this,function(n,t){return 0===n.indexOf(t[0])},[n],Lr)},equalsIgnoreCase:function(n){return t(this,function(n,t){return n===t[0]},[n],"")},anyOfIgnoreCase:function(){var n=ae.apply(ue,arguments);return 0===n.length?h(this):t(this,function(n,t){return-1!==t.indexOf(n)},n,"")},startsWithAnyOfIgnoreCase:function(){var n=ae.apply(ue,arguments);return 0===n.length?h(this):t(this,function(t,n){return n.some(function(n){return 0===t.indexOf(n)})},n,Lr)},anyOf:function(){var i=ae.apply(ue,arguments),o=V;try{i.sort(o)}catch(n){return g(this,Wr)}if(0===i.length)return h(this);var n=new N(this,function(){return m.bound(i[0],i[i.length-1])});n._ondirectionchange=function(n){o="next"===n?V:W,i.sort(o)};var u=0;return n._addAlgorithm(function(n,t,e){for(var r=n.key;0<o(r,i[u]);)if(++u===i.length)return t(e),!1;return 0===o(r,i[u])||(t(function(){n.continue(i[u])}),!1)}),n},notEqual:function(n){return this.inAnyRange([[Vr,n],[n,zr]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var n=ae.apply(ue,arguments);if(0===n.length)return new N(this);try{n.sort(V)}catch(n){return g(this,Wr)}var t=n.reduce(function(n,t){return n?n.concat([[n[n.length-1][1],t]]):[[Vr,t]]},null);return t.push([n[n.length-1],zr]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(n,t){if(0===n.length)return h(this);if(!n.every(function(n){return void 0!==n[0]&&void 0!==n[1]&&V(n[0],n[1])<=0}))return g(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ke.InvalidArgument);var e=!t||!1!==t.includeLowers,r=t&&!0===t.includeUppers;var o,u=V;function i(n,t){return u(n[0],t[0])}try{(o=n.reduce(function(n,t){for(var e,r,i,o,u=0,a=n.length;u<a;++u){var c=n[u];if(z(t[0],c[1])<0&&0<z(t[1],c[0])){c[0]=(i=c[0],o=t[0],z(i,o)<0?i:o),c[1]=(e=c[1],r=t[1],0<z(e,r)?e:r);break}}return u===a&&n.push(t),n},[])).sort(i)}catch(n){return g(this,Wr)}var a=0,c=r?function(n){return 0<V(n,o[a][1])}:function(n){return 0<=V(n,o[a][1])},s=e?function(n){return 0<W(n,o[a][0])}:function(n){return 0<=W(n,o[a][0])};var f=c,l=new N(this,function(){return m.bound(o[0][0],o[o.length-1][1],!e,!r)});return l._ondirectionchange=function(n){u="next"===n?(f=c,V):(f=s,W),o.sort(i)},l._addAlgorithm(function(n,t,e){for(var r,i=n.key;f(i);)if(++a===o.length)return t(e),!1;return!c(r=i)&&!s(r)||(0===z(i,o[a][1])||0===z(i,o[a][0])||t(function(){u===V?n.continue(o[a][0]):n.continue(o[a][1])}),!1)}),l},startsWithAnyOf:function(){var n=ae.apply(ue,arguments);return n.every(function(n){return"string"==typeof n})?0===n.length?h(this):this.inAnyRange(n.map(function(n){return[n,n+Lr]})):g(this,"startsWithAnyOf() only works with strings")}}}),Mt(N.prototype,function(){function o(n,t){n.filter=H(n.filter,t)}function e(n,t,e){var r=n.replayFilter;n.replayFilter=r?function(){return H(r(),t())}:t,n.justLimit=e&&!r}function c(n,t){if(n.isPrimKey)return t;var e=n.table.schema.idxByName[n.index];if(!e)throw new ke.Schema("KeyPath "+n.index+" on object store "+t.name+" is not indexed");return t.index(e.name)}function f(n,t){var e=c(n,t);return n.keysOnly&&"openKeyCursor"in e?e.openKeyCursor(n.range||null,n.dir+n.unique):e.openCursor(n.range||null,n.dir+n.unique)}function s(n,o,t,u,e){var a,r,c=n.replayFilter?H(n.filter,n.replayFilter()):n.filter;function s(){2==++r&&t()}function i(n,t,e){var r,i;c&&!c(t,e,s,u)||("[object ArrayBuffer]"===(i=""+(r=t.primaryKey))&&(i=""+new Uint8Array(r)),Bt(a,i)||(a[i]=!0,o(n,t,e)))}n.or?(a={},r=0,n.or._iterate(i,s,u,e),L(f(n,e),n.algorithm,i,s,u,!n.keysOnly&&n.valueMapper)):L(f(n,e),H(n.algorithm,c),o,t,u,!n.keysOnly&&n.valueMapper)}return{_read:function(n,t){var e=this._ctx;return e.error?e.table._trans(null,Mr.bind(null,e.error)):e.table._idbstore(k,n).then(t)},_write:function(n){var t=this._ctx;return t.error?t.table._trans(null,Mr.bind(null,t.error)):t.table._idbstore(x,n,"locked")},_addAlgorithm:function(n){var t=this._ctx;t.algorithm=H(t.algorithm,n)},_iterate:function(n,t,e,r){return s(this._ctx,n,t,e,r)},clone:function(n){var t=Object.create(this.constructor.prototype),e=Object.create(this._ctx);return n&&Tt(e,n),t._ctx=e,t},raw:function(){return this._ctx.valueMapper=null,this},each:function(r){var i=this._ctx;return this._read(function(n,t,e){s(i,r,n,t,e)})},count:function(n){var o=this._ctx;if(R(o,!0))return this._read(function(t,n,e){var r=c(o,e),i=o.range?r.count(o.range):r.count();i.onerror=ni(n),i.onsuccess=function(n){t(Math.min(n.target.result,o.limit))}},n);var r=0;return this._read(function(n,t,e){s(o,function(){return++r,!1},function(){n(r)},t,e)},n)},sortBy:function(n,t){var e=n.split(".").reverse(),r=e[0],i=e.length-1;function o(n,t){return t?o(n[e[t]],t-1):n[r]}var u="next"===this._ctx.dir?1:-1;function a(n,t){var e=o(n,i),r=o(t,i);return e<r?-u:r<e?u:0}return this.toArray(function(n){return n.sort(a)}).then(t)},toArray:function(n){var a=this._ctx;return this._read(function(t,e,n){var r,i,o,u;l&&"next"===a.dir&&R(a,!0)&&0<a.limit?(r=a.table.hook.reading.fire,i=c(a,n),(o=a.limit<1/0?i.getAll(a.range,a.limit):i.getAll(a.range)).onerror=ni(e),o.onsuccess=ti(r===je?t:function(n){try{t(n.map(r))}catch(n){e(n)}})):(u=[],s(a,function(n){u.push(n)},function(){t(u)},e,n))},n)},offset:function(t){var n=this._ctx;return t<=0||(n.offset+=t,R(n)?e(n,function(){var e=t;return function(n,t){return 0===e||(1===e?--e:t(function(){n.advance(e),e=0}),!1)}}):e(n,function(){var n=t;return function(){return--n<0}})),this},limit:function(n){return this._ctx.limit=Math.min(this._ctx.limit,n),e(this._ctx,function(){var r=n;return function(n,t,e){return--r<=0&&t(e),0<=r}},!0),this},until:function(r,i){return o(this._ctx,function(n,t,e){return!r(n.value)||(t(e),i)}),this},first:function(n){return this.limit(1).toArray(function(n){return n[0]}).then(n)},last:function(n){return this.reverse().first(n)},filter:function(t){var n,e;return o(this._ctx,function(n){return t(n.value)}),n=this._ctx,e=t,n.isMatch=H(n.isMatch,e),this},and:function(n){return this.filter(n)},or:function(n){return new M(this._ctx.table,n,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(n,t){e(t.key,t)})},eachUniqueKey:function(n){return this._ctx.unique="unique",this.eachKey(n)},eachPrimaryKey:function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(n,t){e(t.primaryKey,t)})},keys:function(n){var t=this._ctx;t.keysOnly=!t.isMatch;var e=[];return this.each(function(n,t){e.push(t.key)}).then(function(){return e}).then(n)},primaryKeys:function(n){var o=this._ctx;if(l&&"next"===o.dir&&R(o,!0)&&0<o.limit)return this._read(function(n,t,e){var r=c(o,e),i=o.limit<1/0?r.getAllKeys(o.range,o.limit):r.getAllKeys(o.range);i.onerror=ni(t),i.onsuccess=ti(n)}).then(n);o.keysOnly=!o.isMatch;var e=[];return this.each(function(n,t){e.push(t.primaryKey)}).then(function(){return e}).then(n)},uniqueKeys:function(n){return this._ctx.unique="unique",this.keys(n)},firstKey:function(n){return this.limit(1).keys(function(n){return n[0]}).then(n)},lastKey:function(n){return this.reverse().firstKey(n)},distinct:function(){var n=this._ctx,t=n.index&&n.table.schema.idxByName[n.index];if(!t||!t.multi)return this;var r={};return o(this._ctx,function(n){var t=n.primaryKey.toString(),e=Bt(r,t);return r[t]=!0,!e}),this},modify:function(y){var g=this,n=this._ctx.table.hook,m=n.updating.fire,b=n.deleting.fire;return this._write(function(n,t,e,i){var o,u,a,c;a="function"==typeof y?m===Oe&&b===Oe?y:function(t){var n,e,r=ee(t);if(!1===y.call(this,t,this))return!1;Bt(this,"value")?(n=re(r,this.value),(e=m.call(this,n,this.primKey,r,i))&&(t=this.value,It(e).forEach(function(n){Xt(t,n,e[n])}))):b.call(this,this.primKey,t,i)}:m===Oe?(o=It(y),u=o.length,function(n){for(var t=!1,e=0;e<u;++e){var r=o[e],i=y[r];Yt(n,r)!==i&&(Xt(n,r,i),t=!0)}return t}):(y=$t(c=y),function(e){var r=!1,n=m.call(this,y,this.primKey,ee(e),i);return n&&Tt(y,n),It(y).forEach(function(n){var t=y[n];Yt(e,n)!==t&&(Xt(e,n,t),r=!0)}),n&&(y=$t(c)),r});var s=0,f=0,r=!1,l=[],h=[],d=null;function p(n){return n&&(l.push(n),h.push(d)),t(new me(0,l,f,h))}function v(){r&&f+l.length===s&&(0<l.length?p():n(f))}g.clone().raw()._iterate(function(n,t){d=t.primaryKey;var e,r={primKey:t.primaryKey,value:n,onsuccess:null,onerror:null};function i(n){return l.push(n),h.push(r.primKey),v(),!0}!1!==a.call(r,n,r)?(e=!Bt(r,"value"),++s,Jt(function(){var n=e?t.delete():t.update(r.value);n._hookCtx=r,n.onerror=ei(i),n.onsuccess=Zr(function(){++f,v()})},i)):r.onsuccess&&r.onsuccess(r.value)},function(){r=!0,v()},p,e)})},delete:function(){var c=this,s=this._ctx,u=s.range,f=s.table.hook.deleting.fire,l=f!==Oe;if(!l&&R(s)&&(s.isPrimKey&&!Yr||!u))return this._write(function(e,r,i){var o=ni(r),n=u?i.count(u):i.count();n.onerror=o,n.onsuccess=function(){var t=n.result;Jt(function(){var n=u?i.delete(u):i.clear();n.onerror=o,n.onsuccess=function(){return e(t)}},function(n){return r(n)})}});var h=l?2e3:1e4;return this._write(function(n,t,e,r){var i=0,o=c.clone({keysOnly:!s.isMatch&&!l}).distinct().limit(h).raw(),u=[],a=function(){return o.each(l?function(n,t){u.push([t.primaryKey,t.value])}:function(n,t){u.push(t.primaryKey)}).then(function(){return l?u.sort(function(n,t){return V(n[0],t[0])}):u.sort(V),F(e,r,u,l,f)}).then(function(){var n=u.length;return i+=n,u=[],n<h?i:a()})};n(a())})}}}),Tt(this,{Collection:N,Table:T,Transaction:B,Version:A,WhereClause:M}),S.on("versionchange",function(n){0<n.newVersion?console.warn("Another connection wants to upgrade database '"+S.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+S.name+"'. Closing db now to resume the delete request."),S.close()}),S.on("blocked",function(n){!n.newVersion||n.newVersion<n.oldVersion?console.warn("Dexie.delete('"+S.name+"') was blocked"):console.warn("Upgrade '"+S.name+"' blocked by other connection holding version "+n.oldVersion/10)}),c.forEach(function(n){n(S)})}function $r(e,r){return It(r).forEach(function(n){var t=function n(t){if("function"==typeof t)return new t;if(Dt(t))return[n(t[0])];if(t&&"object"==typeof t){var e={};return $r(e,t),e}return t}(r[n]);e[n]=t}),e}function Zr(o){return mr(function(n){var t=n.target,e=t._hookCtx,r=e.value||t.result,i=e&&e.onsuccess;i&&i(r),o&&o(r)},o)}function ni(t){return mr(function(n){return ri(n),t(n.target.error),!1})}function ti(t){return mr(function(n){t(n.target.result)})}function ei(o){return mr(function(n){var t=n.target,e=t.error,r=t._hookCtx,i=r&&r.onerror;return i&&i(e),ri(n),o(e),!1})}function ri(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}function ii(t){function n(n){return t.next(n)}var i=e(n),o=e(function(n){return t.throw(n)});function e(r){return function(n){var t=r(n),e=t.value;return t.done?e:e&&"function"==typeof e.then?e.then(i,o):Dt(e)?or.all(e).then(i,o):i(e)}}return e(n)()}function oi(n,t,e,r,i,o,u){this.name=n,this.keyPath=t,this.unique=e,this.multi=r,this.auto=i,this.compound=o,this.dotted=u;var a="string"==typeof t?t:t&&"["+[].join.call(t,"+")+"]";this.src=(e?"&":"")+(r?"*":"")+(i?"++":"")+a}function ui(n,t,e,r){this.name=n,this.primKey=t||new oi,this.indexes=e||[new oi],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=Qt(e,function(n){return[n.name,n]})}function ai(n){return 1===n.length?n[0]:n}function ci(n){var t=n&&(n.getDatabaseNames||n.webkitGetDatabaseNames);return t&&t.bind(n)}se(ce,Rr),Mt(Xr,Se),Mt(Xr,{delete:function(n){var t=new Xr(n),e=t.delete();return e.onblocked=function(n){return t.on("blocked",n),this},e},exists:function(n){return new Xr(n).open().then(function(n){return n.close(),!0}).catch(Xr.NoSuchDatabaseError,function(){return!1})},getDatabaseNames:function(n){var r=ci(Xr.dependencies.indexedDB);return r?new or(function(t,n){var e=r();e.onsuccess=function(n){t(zt(n.target.result,0))},e.onerror=ni(n)}).then(n):qr.dbnames.toCollection().primaryKeys(n)},defineClass:function(){return function(n){n&&Tt(this,n)}},applyStructure:$r,ignoreTransaction:function(n){return tr.trans?Cr(tr.transless,n):n()},vip:function(n){return Or(function(){return tr.letThrough=!0,n()})},async:function(t){return function(){try{var n=ii(t.apply(this,arguments));return n&&"function"==typeof n.then?n:or.resolve(n)}catch(n){return Mr(n)}}},spawn:function(n,t,e){try{var r=ii(n.apply(e,t||[]));return r&&"function"==typeof r.then?r:or.resolve(r)}catch(n){return Mr(n)}},currentTransaction:{get:function(){return tr.trans||null}},waitFor:function(n,t){var e=or.resolve("function"==typeof n?Xr.ignoreTransaction(n):n).timeout(t||6e4);return tr.trans?tr.trans.waitFor(e):e},Promise:or,debug:{get:function(){return ce},set:function(n){se(n,"dexie"===n?function(){return!0}:Rr)}},derive:qt,extend:Tt,props:Mt,override:Vt,Events:Nr,getByKeyPath:Yt,setByKeyPath:Xt,delByKeyPath:function(t,n){"string"==typeof n?Xt(t,n,void 0):"length"in n&&[].map.call(n,function(n){Xt(t,n,void 0)})},shallowClone:$t,deepClone:ee,getObjectDiff:re,asap:Gt,maxKey:zr,minKey:Vr,addons:[],connections:Qr,MultiModifyError:ke.Modify,errnames:we,IndexSpec:oi,TableSchema:ui,dependencies:function(){try{return{indexedDB:Ct.indexedDB||Ct.mozIndexedDB||Ct.webkitIndexedDB||Ct.msIndexedDB,IDBKeyRange:Ct.IDBKeyRange||Ct.webkitIDBKeyRange}}catch(n){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:Ur,version:Ur.split(".").map(function(n){return parseInt(n)}).reduce(function(n,t,e){return n+t/Math.pow(10,2*e)}),default:Xr,Dexie:Xr}),or.rejectionMapper=function(n,t){if(!n||n instanceof ge||n instanceof TypeError||n instanceof SyntaxError||!n.name||!xe[n.name])return n;var e=new xe[n.name](t||n.message,n);return"stack"in n&&Rt(e,"stack",{get:function(){return this.inner.stack}}),e},(qr=new Xr("__dbnames")).version(1).stores({dbnames:"name"}),function(){var n="Dexie.DatabaseNames";try{void 0!==Ct.document&&(JSON.parse(localStorage.getItem(n)||"[]").forEach(function(n){return qr.dbnames.put({name:n}).catch(Oe)}),localStorage.removeItem(n))}catch(n){}}();var si=(fi.getInstanceDexie=function(t){var n=this.dexies.find(function(n){return n.key&&n.key===t});return n?{key:t,db:n.db,store:n.store,openState:n.openState}:null},fi.registerInstanceDexie=function(n,e,r){function t(e){return Et(this,void 0,void 0,function(){var t;return At(this,function(n){switch(n.label){case 0:return t=new Xr(e),[4,Xr.exists(t.name)];case 1:return n.sent()||t.version(1).stores({}),r&&Array.isArray(r)&&r.map(function(n){t.version(1).stores(n)}),[4,t.open()];case 2:return n.sent(),[2,t]}})})}var i=this,o=this.getInstanceDexie(e);o&&o.db?o.db.isOpen()||t(n).then(function(n){o.db=n,i.dexies=i.dexies.map(function(n){return n.key===o.key?o:n})}):this.getInstanceDexie(e)||(this.dexies.push({key:e,store:n,db:null,openState:"pending"}),t(n).then(function(t){i.getInstanceDexie(e)&&"pending"===i.getInstanceDexie(e).openState&&(i.dexies=i.dexies.map(function(n){return n.key===e?Pt(Pt({},n),{db:t,openState:"complete"}):n}))}))},fi.dexies=[],fi);function fi(){}return n.DexieUtils=si,n}({});