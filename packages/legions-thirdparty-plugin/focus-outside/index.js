var els=[],elMap=new Map,defaultClass="focus-outside";function isNotFocusable(e){return isNaN(parseInt(e.getAttribute("tabindex")))}function setFocusable(e){e.setAttribute("tabindex","-1")}function getNode(t){return els.find(function(e){return e.contains(t)||e===t})}function addClass(e,t){var n=e.className.split(" ");-1<n.indexOf(t)||(n.push(t),e.className=n.join(" "))}function removeClass(e,t){var n=e.className.split(" "),t=n.indexOf(t);t<0||(n.splice(t,1),e.className=n.join(" "))}function focusinHandler(e){var t=getNode(e.target);t&&(t=(e=findNodeMap(elMap.entries(),t)||{}).el,e=e.nodeList,t&&clearTimeout(e.timerId))}function focusoutHandler(e){var t,n=getNode(e.target);n&&(e=(t=findNodeMap(elMap.entries(),n)||{}).el,n=t.key,t=t.nodeList,e&&(t.timerId=setTimeout(n,10)))}function findNodeMap(e,s){var i={};return elMap.forEach(function(e,t){var n=t,t=e,e=t.find(function(e){return e.node===s});e&&(i={key:n,nodeList:t,el:e})}),i}function focusBind(e,t,n){(n=void 0===n?"focus-outside":n)&&(defaultClass=n),els.indexOf(e)<0&&els.push(e),elMap.has(t)?elMap.get(t).push({node:e,oldTabIndex:e.getAttribute("tabindex")}):elMap.set(t,[{node:e,oldTabIndex:e.getAttribute("tabindex")}]),isNotFocusable(e)&&setFocusable(e),addClass(e,defaultClass),e.addEventListener("focusin",focusinHandler),e.addEventListener("focusout",focusoutHandler)}function focusUnbind(e){var t,n=findNodeMap(elMap.entries(),e)||{},s=n.el,i=n.key,a=n.nodeList;s&&(t=s.node,e=s.oldTabIndex,-1<(n=els.indexOf(t))&&els.splice(n),removeClass(t,defaultClass),e?t.setAttribute("tabindex",e):t.removeAttribute("tabindex"),t.removeEventListener("focusin",focusinHandler),t.removeEventListener("focusout",focusoutHandler),s=a.indexOf(s),-1<n&&a.splice(s,1),a.length||elMap.delete(i))}export{focusBind,focusUnbind};
